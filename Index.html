<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Professional Open-Channel Hydraulics Analysis Tool for Civil Engineers">
    <meta name="author" content="HydroTech Engineering Solutions">
    <title>HydroFlow Pro | Open-Channel Hydraulics Analysis</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Charts & Visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.2.0"></script>
    
    <!-- Data Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- App Styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/engineering.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="assets/img/logo.svg">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0066cc">
    
    <!-- SEO -->
    <meta property="og:title" content="HydroFlow Pro | Engineering Hydraulics Tool">
    <meta property="og:description" content="Professional-grade open-channel hydraulics analysis software">
    <meta property="og:image" content="https://yourdomain.com/assets/img/og-image.png">
    <meta property="og:url" content="https://yourdomain.com">
</head>
<body class="dark-mode">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="hydro-loader">
                <div class="wave"></div>
                <div class="wave"></div>
                <div class="wave"></div>
            </div>
            <p class="loading-text">Initializing Engineering Modules...</p>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-left">
                <div class="logo">
                    <i class="fas fa-water"></i>
                    <span class="logo-text">HydroFlow</span>
                    <span class="logo-pro">PRO</span>
                </div>
                <div class="nav-divider"></div>
                <div class="project-info">
                    <span class="project-name" id="projectName">Untitled Project</span>
                    <button class="btn-project-edit" onclick="editProjectName()">
                        <i class="fas fa-edit"></i>
                    </button>
                </div>
            </div>
            
            <div class="nav-center">
                <div class="nav-tabs">
                    <button class="nav-tab active" data-tab="design">
                        <i class="fas fa-ruler-combined"></i>
                        <span>Design</span>
                    </button>
                    <button class="nav-tab" data-tab="analysis">
                        <i class="fas fa-chart-line"></i>
                        <span>Analysis</span>
                    </button>
                    <button class="nav-tab" data-tab="optimization">
                        <i class="fas fa-robot"></i>
                        <span>Optimization</span>
                    </button>
                    <button class="nav-tab" data-tab="reports">
                        <i class="fas fa-file-contract"></i>
                        <span>Reports</span>
                    </button>
                </div>
            </div>
            
            <div class="nav-right">
                <button class="btn-nav-icon" title="Undo" onclick="history.undo()">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="btn-nav-icon" title="Redo" onclick="history.redo()">
                    <i class="fas fa-redo"></i>
                </button>
                <div class="nav-divider"></div>
                
                <button class="btn-nav-icon" id="notificationBtn" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationCount">3</span>
                </button>
                
                <button class="btn-nav-icon" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-sun"></i>
                </button>
                
                <div class="user-menu">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-info">
                        <span class="user-name">Engineer</span>
                        <span class="user-role">Professional License</span>
                    </div>
                    <button class="btn-dropdown">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-sliders-h"></i>
                        Channel Properties
                    </h3>
                    
                    <div class="property-group">
                        <div class="property-header">
                            <span>Cross-Section</span>
                            <div class="property-actions">
                                <select id="channelType" class="select-sm">
                                    <option value="rectangular">Rectangular</option>
                                    <option value="trapezoidal">Trapezoidal</option>
                                    <option value="triangular">Triangular</option>
                                    <option value="circular">Circular</option>
                                    <option value="natural">Natural</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Dynamic inputs based on channel type -->
                        <div id="channelInputs">
                            <!-- Rectangular inputs (default) -->
                            <div class="input-row">
                                <label for="channelWidth">
                                    <i class="fas fa-arrows-alt-h"></i>
                                    Width (b)
                                </label>
                                <div class="input-with-units">
                                    <input type="number" id="channelWidth" value="1.5" step="0.01" min="0.1">
                                    <span class="unit">m</span>
                                </div>
                            </div>
                            
                            <div class="input-row">
                                <label for="flowDepth">
                                    <i class="fas fa-arrows-alt-v"></i>
                                    Flow Depth (y)
                                </label>
                                <div class="input-with-units">
                                    <input type="number" id="flowDepth" value="0.5" step="0.01" min="0.01">
                                    <span class="unit">m</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <div class="property-header">
                            <span>Hydraulic Properties</span>
                        </div>
                        
                        <div class="input-row">
                            <label for="discharge">
                                <i class="fas fa-tachometer-alt"></i>
                                Discharge (Q)
                            </label>
                            <div class="input-with-units">
                                <input type="number" id="discharge" value="2.0" step="0.1" min="0.01">
                                <span class="unit">m³/s</span>
                            </div>
                        </div>
                        
                        <div class="input-row">
                            <label for="slope">
                                <i class="fas fa-angle-down"></i>
                                Slope (S₀)
                            </label>
                            <div class="input-with-units">
                                <input type="number" id="slope" value="0.001" step="0.0001" min="0.0001">
                                <span class="unit">m/m</span>
                            </div>
                        </div>
                        
                        <div class="input-row">
                            <label for="roughness">
                                <i class="fas fa-mountain"></i>
                                Manning's n
                            </label>
                            <div class="input-with-units">
                                <input type="number" id="roughness" value="0.025" step="0.001" min="0.01" max="0.1">
                                <span class="unit">-</span>
                            </div>
                            <div class="input-help">
                                <button class="btn-help" onclick="showRoughnessGuide()">
                                    <i class="fas fa-question-circle"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <div class="property-header">
                            <span>Material Properties</span>
                        </div>
                        
                        <div class="input-row">
                            <label for="soilType">
                                <i class="fas fa-layer-group"></i>
                                Soil Type
                            </label>
                            <select id="soilType" class="select-full">
                                <option value="concrete">Concrete (n=0.013)</option>
                                <option value="earth">Earth (n=0.025)</option>
                                <option value="gravel">Gravel (n=0.028)</option>
                                <option value="rock">Rock (n=0.035)</option>
                                <option value="vegetation">Vegetation (n=0.035-0.15)</option>
                                <option value="custom">Custom...</option>
                            </select>
                        </div>
                        
                        <div class="input-row">
                            <label for="temperature">
                                <i class="fas fa-thermometer-half"></i>
                                Water Temperature
                            </label>
                            <div class="input-with-units">
                                <input type="number" id="temperature" value="20" step="0.1">
                                <span class="unit">°C</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sidebar-actions">
                        <button class="btn btn-primary btn-block" onclick="runAnalysis()">
                            <i class="fas fa-play"></i>
                            Run Analysis
                        </button>
                        
                        <div class="btn-group">
                            <button class="btn btn-secondary" onclick="saveProject()">
                                <i class="fas fa-save"></i>
                                Save
                            </button>
                            <button class="btn btn-secondary" onclick="loadProject()">
                                <i class="fas fa-folder-open"></i>
                                Load
                            </button>
                            <button class="btn btn-secondary" onclick="resetInputs()">
                                <i class="fas fa-redo"></i>
                                Reset
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Calculation History -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-history"></i>
                        Calculation History
                    </h3>
                    <div class="history-list" id="historyList">
                        <!-- Dynamic history items -->
                    </div>
                </div>
            </aside>

            <!-- Main Panel -->
            <div class="main-panel">
                <!-- Design Tab -->
                <div class="tab-content active" id="designTab">
                    <div class="design-container">
                        <!-- Channel Visualization -->
                        <div class="card card-lg">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-project-diagram"></i>
                                    Channel Cross-Section
                                </h3>
                                <div class="card-actions">
                                    <button class="btn-card-action" onclick="toggle3DView()">
                                        <i class="fas fa-cube"></i>
                                        3D View
                                    </button>
                                    <button class="btn-card-action" onclick="exportDiagram()">
                                        <i class="fas fa-download"></i>
                                        Export
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="visualization-container">
                                    <canvas id="channelCanvas" width="800" height="400"></canvas>
                                    <div class="viz-controls">
                                        <button class="btn-viz-control" onclick="zoomIn()">
                                            <i class="fas fa-search-plus"></i>
                                        </button>
                                        <button class="btn-viz-control" onclick="zoomOut()">
                                            <i class="fas fa-search-minus"></i>
                                        </button>
                                        <button class="btn-viz-control" onclick="resetView()">
                                            <i class="fas fa-expand"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Results Panel -->
                        <div class="card">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-bolt"></i>
                                    Quick Results
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="metrics-grid">
                                    <div class="metric">
                                        <div class="metric-label">Critical Depth</div>
                                        <div class="metric-value" id="criticalDepth">0.00 m</div>
                                        <div class="metric-status safe">
                                            <i class="fas fa-check-circle"></i>
                                            Stable
                                        </div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-label">Normal Depth</div>
                                        <div class="metric-value" id="normalDepth">0.00 m</div>
                                        <div class="metric-status warning">
                                            <i class="fas fa-exclamation-triangle"></i>
                                            Review
                                        </div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-label">Froude Number</div>
                                        <div class="metric-value" id="froudeNumber">0.00</div>
                                        <div class="metric-status safe">
                                            <i class="fas fa-check-circle"></i>
                                            Subcritical
                                        </div>
                                    </div>
                                    <div class="metric">
                                        <div class="metric-label">Velocity</div>
                                        <div class="metric-value" id="flowVelocity">0.00 m/s</div>
                                        <div class="metric-status">
                                            <i class="fas fa-tachometer-alt"></i>
                                            Acceptable
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analysis Tab -->
                <div class="tab-content" id="analysisTab">
                    <div class="analysis-container">
                        <!-- Energy Diagram -->
                        <div class="card card-lg">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-chart-line"></i>
                                    Specific Energy Diagram
                                </h3>
                                <div class="card-actions">
                                    <select id="chartType" class="select-sm">
                                        <option value="energy">Energy Diagram</option>
                                        <option value="momentum">Momentum Function</option>
                                        <option value="rating">Rating Curve</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="analysisChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Detailed Results Table -->
                        <div class="card">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-table"></i>
                                    Hydraulic Parameters
                                </h3>
                                <button class="btn-card-action" onclick="exportTable()">
                                    <i class="fas fa-file-export"></i>
                                    Export CSV
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="engineering-table">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Symbol</th>
                                                <th>Value</th>
                                                <th>Units</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="resultsTable">
                                            <!-- Dynamic content -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Optimization Tab -->
                <div class="tab-content" id="optimizationTab">
                    <div class="optimization-container">
                        <!-- Optimization Controls -->
                        <div class="card">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-cogs"></i>
                                    Optimization Parameters
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="optimization-controls">
                                    <div class="control-group">
                                        <label>Objective Function</label>
                                        <select id="objectiveFunction" class="select-full">
                                            <option value="minCost">Minimize Cost</option>
                                            <option value="maxEfficiency">Maximize Efficiency</option>
                                            <option value="minDepth">Minimize Depth</option>
                                            <option value="maxStability">Maximize Stability</option>
                                        </select>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label>Constraints</label>
                                        <div class="constraints-list">
                                            <div class="constraint">
                                                <input type="checkbox" id="maxVelocity" checked>
                                                <label for="maxVelocity">Max Velocity ≤ 3 m/s</label>
                                            </div>
                                            <div class="constraint">
                                                <input type="checkbox" id="minFroude" checked>
                                                <label for="minFroude">Froude ≤ 0.9</label>
                                            </div>
                                            <div class="constraint">
                                                <input type="checkbox" id="freeboard" checked>
                                                <label for="freeboard">Freeboard ≥ 0.3 m</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary btn-block" onclick="runOptimization()">
                                        <i class="fas fa-rocket"></i>
                                        Run Optimization
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Optimization Results -->
                        <div class="card card-lg">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-chart-bar"></i>
                                    Optimization Results
                                </h3>
                            </div>
                            <div class="card-body">
                                <canvas id="optimizationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-content" id="reportsTab">
                    <div class="reports-container">
                        <!-- Report Generator -->
                        <div class="card">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-file-alt"></i>
                                    Generate Report
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="report-options">
                                    <div class="option-group">
                                        <h4>Report Type</h4>
                                        <select id="reportType" class="select-full">
                                            <option value="technical">Technical Report</option>
                                            <option value="executive">Executive Summary</option>
                                            <option value="design">Design Report</option>
                                            <option value="compliance">Compliance Report</option>
                                        </select>
                                    </div>
                                    
                                    <div class="option-group">
                                        <h4>Include Sections</h4>
                                        <div class="checklist">
                                            <label>
                                                <input type="checkbox" checked>
                                                Executive Summary
                                            </label>
                                            <label>
                                                <input type="checkbox" checked>
                                                Design Criteria
                                            </label>
                                            <label>
                                                <input type="checkbox" checked>
                                                Calculations
                                            </label>
                                            <label>
                                                <input type="checkbox" checked>
                                                Results & Analysis
                                            </label>
                                            <label>
                                                <input type="checkbox">
                                                Cost Estimation
                                            </label>
                                            <label>
                                                <input type="checkbox">
                                                Appendices
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="option-group">
                                        <h4>Export Format</h4>
                                        <div class="format-buttons">
                                            <button class="btn-format" data-format="pdf">
                                                <i class="fas fa-file-pdf"></i>
                                                PDF
                                            </button>
                                            <button class="btn-format" data-format="word">
                                                <i class="fas fa-file-word"></i>
                                                Word
                                            </button>
                                            <button class="btn-format" data-format="excel">
                                                <i class="fas fa-file-excel"></i>
                                                Excel
                                            </button>
                                            <button class="btn-format" data-format="html">
                                                <i class="fas fa-code"></i>
                                                HTML
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <button class="btn btn-primary btn-block" onclick="generateReport()">
                                        <i class="fas fa-magic"></i>
                                        Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Report Preview -->
                        <div class="card card-lg">
                            <div class="card-header">
                                <h3>
                                    <i class="fas fa-eye"></i>
                                    Report Preview
                                </h3>
                            </div>
                            <div class="card-body">
                                <div class="report-preview" id="reportPreview">
                                    <!-- Dynamic preview -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-left">
                <span class="status-item">
                    <i class="fas fa-microchip"></i>
                    <span id="calculationTime">0.00 ms</span>
                </span>
                <span class="status-item">
                    <i class="fas fa-database"></i>
                    <span id="projectSize">0 KB</span>
                </span>
            </div>
            
            <div class="status-center">
                <div class="validation-status">
                    <i class="fas fa-check-circle" id="validationIcon"></i>
                    <span id="validationStatus">All inputs valid</span>
                </div>
            </div>
            
            <div class="status-right">
                <span class="status-item">
                    <i class="fas fa-code-branch"></i>
                    <span>v2.1.0</span>
                </span>
                <span class="status-item">
                    <i class="fas fa-server"></i>
                    <span id="connectionStatus">Online</span>
                </span>
            </div>
        </footer>
    </div>

    <!-- Modal System -->
    <div class="modal-overlay" id="modalOverlay">
        <!-- Modals will be injected here -->
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Context Menu -->
    <div class="context-menu" id="contextMenu"></div>

    <!-- App Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/calculations.js"></script>
    <script src="assets/js/visualization.js"></script>
    <script src="assets/js/database.js"></script>
    <script src="assets/js/export.js"></script>
    <script src="assets/js/validation.js"></script>
    <script src="assets/js/optimization.js"></script>
    <script src="assets/js/reports.js"></script>
    <script src="assets/js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js');
            });
        }
    </script>
</body>
</html>
